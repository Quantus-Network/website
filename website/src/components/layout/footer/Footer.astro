---
import BrandLogo from "@/assets/brand/brand-logo.svg";
import BrandName from "@/assets/brand/brand-name.svg";

import LanguageSwitcher from "@/components/ui/LanguageSwitcher.astro";
import Separator from "@/components/ui/Separator.astro";
import SiteSocials from "@/components/ui/SiteSocials.astro";
import SphereDecoration from "@/components/ui/SphereDecoration.astro";
import SubscribeForm from "@/components/ui/SubscribeForm.astro";
import { FOOTER_NAVIGATIONS } from "@/constants/footer-navigations";

import { applyStyles } from "@/utils/apply-styles";
import {
  createTranslator,
  getLocaleFromUrl,
  getLocalizedPath,
} from "@/utils/i18n";

const locale = getLocaleFromUrl(Astro.url.pathname);
const t = await createTranslator(locale);

const year = new Date().getFullYear();

const currentPath = Astro.url.pathname;
const isCurrentPage = (href: string) =>
  currentPath === getLocalizedPath(locale, href);
---

<footer
  id="footer"
  class="border-footer-separator relative flex flex-col overflow-hidden border-t px-4 pb-[56px] backdrop-blur-lg md:pb-[30px]"
>
  <SphereDecoration
    variant="4"
    size={124}
    class="absolute top-[12rem] right-[3rem] -z-10 min-[453px]:top-[11rem] min-[482px]:top-[9rem] md:top-[20rem] md:left-[40%]"
  />
  <SphereDecoration
    variant="5"
    size={318}
    class="absolute -right-[6.3rem] -bottom-[9.3rem] -z-10"
  />
  <SphereDecoration
    variant="6"
    size={240}
    class="absolute -bottom-[8rem] left-[6rem] -z-10 hidden md:block"
  />

  <div
    class="max-w-content flex w-full flex-col items-center gap-9 pt-[76px] pb-9 md:mx-auto md:flex-row md:justify-between md:pt-[57px] md:pb-[67px]"
  >
    <div>
      <h2 class="font-small-title">{t("footer.newsletter.title")}</h2>
      <p class="font-body-mobile text-text-content-secondary md:font-body">
        {t("footer.newsletter.description")}
      </p>
    </div>

    <SubscribeForm />
  </div>

  <div class="max-w-content mx-auto w-full">
    <Separator />
  </div>

  <div
    class="max-w-content flex w-full flex-col md:mx-auto md:flex-row md:justify-between md:gap-x-6 md:pt-[56px]"
  >
    <div
      class="flex flex-col items-center gap-4 pt-[116px] md:items-end md:pt-0"
    >
      <div class="flex-shrink-0">
        <a
          href={getLocalizedPath(locale, "/")}
          class="flex items-center gap-3 hover:brightness-125"
        >
          <BrandLogo
            title="Quantus's brand logo"
            class="min-[360px]:h-[61px] min-[360px]:w-[65px] md:h-[75px] md:w-[80px]"
          />
          <BrandName
            title="Quantus's brand name"
            class="min-[360px]:h-[35px] min-[360px]:w-[256px] md:h-[43px] md:w-[316px]"
          />
        </a>
      </div>

      <p
        class="font-body-mobile text-text-content-secondary md:font-body text-center md:max-w-[316px] md:text-left"
      >
        {t("footer.description")}
      </p>
    </div>

    <div
      class="flex justify-center gap-x-[68px] pt-[48px] md:pt-0 lg:gap-x-[104px]"
    >
      {
        FOOTER_NAVIGATIONS.map((navigation) => (
          <div class="flex flex-col gap-y-5">
            <h3 class="font-tag">{t(navigation.label)}</h3>

            <ul class="flex flex-col gap-y-4">
              {navigation.children.map((navItem) => (
                <li>
                  <a
                    href={getLocalizedPath(locale, navItem.href)}
                    target={navItem?.target}
                    rel={navItem?.rel}
                    class={applyStyles(
                      "font-small text-text-content-secondary transition-colors duration-200 hover:text-white",
                      isCurrentPage(navItem.href) && "text-white",
                    )}
                  >
                    {t(navItem.label)}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>
  </div>

  <div
    class="max-w-content mx-auto flex w-full flex-col items-center gap-10 pt-[98px] text-center md:pt-[83px] lg:flex-row"
  >
    <div class="order-1 max-w-[300px] grow">
      <LanguageSwitcher class="max-w-[200px]" />
    </div>

    <div class="order-3 grow lg:order-2">
      <p id="footer-copyright" class="font-small text-text-content-secondary">
        {t("footer.copyright", { year })}
      </p>
    </div>

    <div class="order-2 max-w-[300px] grow lg:order-3">
      <SiteSocials />
    </div>
  </div>
</footer>
