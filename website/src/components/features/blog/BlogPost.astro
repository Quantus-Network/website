---
import Layout from "@/components/layout/Layout.astro";
import Tag from "@/components/ui/Tag.astro";
import type { CollectionEntry } from "astro:content";
import {
  getLocaleFromUrl,
  getLocalizedPath,
  createTranslator,
} from "@/utils/i18n";

type Props = CollectionEntry<"blog">["data"];

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  heroAlt,
  tags = [],
} = Astro.props;

const currentLocale = getLocaleFromUrl(Astro.url.pathname);
const t = await createTranslator(currentLocale);
---

<Layout title={title} description={description}>
  <article class="container mx-auto max-w-3xl px-4 py-12">
    <div class="mb-8 text-center">
      {
        heroImage && (
          <img
            width={1020}
            height={510}
            src={heroImage}
            alt={heroAlt || title}
            class="mb-8 w-full rounded-xl object-cover"
          />
        )
      }
      <div class="mb-4 text-gray-400">
        <time datetime={pubDate.toISOString()}>
          {
            pubDate.toLocaleDateString(currentLocale, {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          }
        </time>
        {
          updatedDate && (
            <div class="italic">
              Last updated on{" "}
              {updatedDate.toLocaleDateString(currentLocale, {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
            </div>
          )
        }
      </div>
      <h1 class="mb-4 text-4xl font-bold text-white md:text-5xl">{title}</h1>
      <hr class="my-4 border-white/10" />
      {
        tags.length > 0 && (
          <div class="mb-8 flex flex-wrap justify-center gap-2">
            {tags.map((tag) => (
              <Tag>
                <a
                  href={getLocalizedPath(currentLocale, `/blog/tags/${tag}`)}
                  class="hover:text-primary transition-colors"
                >
                  {t(`blog.tags.${tag}`) || tag}
                </a>
              </Tag>
            ))}
          </div>
        )
      }
    </div>
    <div class="prose prose-invert mx-auto max-w-none">
      <slot />
    </div>
  </article>
</Layout>

<style is:global>
  /* Basic typography for blog posts since we might not have @tailwindcss/typography */
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4 {
    color: var(--color-text-title-primary);
    margin-top: 2em;
    margin-bottom: 1em;
    font-weight: 700;
  }
  .prose h1 {
    font-size: 2.25em;
  }
  .prose h2 {
    font-size: 1.875em;
  }
  .prose h3 {
    font-size: 1.5em;
  }

  .prose p {
    margin-bottom: 1.25em;
    line-height: 1.75;
    color: var(--color-text-content-primary);
  }

  .prose ul {
    list-style-type: disc;
    padding-left: 1.5em;
    margin-bottom: 1.25em;
  }

  .prose ol {
    list-style-type: decimal;
    padding-left: 1.5em;
    margin-bottom: 1.25em;
  }

  .prose li {
    margin-bottom: 0.5em;
  }

  .prose a {
    color: var(--color-primary, #3b82f6);
    text-decoration: underline;
  }

  .prose blockquote {
    border-left: 4px solid var(--color-primary, #3b82f6);
    padding-left: 1em;
    font-style: italic;
    margin-bottom: 1.25em;
  }

  .prose code {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 0.2em 0.4em;
    border-radius: 0.25em;
    font-family: monospace;
  }

  .prose pre {
    background-color: #1a1a1a;
    padding: 1em;
    border-radius: 0.5em;
    overflow-x: auto;
    margin-bottom: 1.25em;
  }

  .prose pre code {
    background-color: transparent;
    padding: 0;
  }
</style>
