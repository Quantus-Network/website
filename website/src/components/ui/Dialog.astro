---
interface Props {
  id: string;
  title?: string;
  class?: string;
}

const { id, title = "Dialog", class: className } = Astro.props;
---

<dialog
  id={id}
  class:list={[
    // Base layout & positioning
    "fixed inset-0 z-50 m-auto w-full max-w-md rounded-xl bg-white p-6 shadow-2xl",
    // Animation transitions (using modern CSS transition-behavior for dialogs)
    "transition-all duration-300 ease-out",
    "scale-95 opacity-0",
    "open:scale-100 open:opacity-100",
    // Backdrop styling using arbitrary variant
    "[&::backdrop]:bg-black/50 [&::backdrop]:backdrop-blur-sm",
    className,
  ]}
>
  <div class="mb-4 flex items-center justify-between">
    <h3 class="text-xl font-bold text-gray-900">{title}</h3>
    <button
      aria-label="Close modal"
      class="cursor-pointer rounded-full p-1 text-gray-500 transition-colors hover:bg-gray-100 hover:text-gray-700"
      onclick={`document.getElementById('${id}').close()`}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="size-5"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
          clip-rule="evenodd"></path>
      </svg>
    </button>
  </div>

  <div class="mt-2 text-gray-600">
    <slot />
  </div>
</dialog>

<script define:vars={{ id }}>
  // Execute this on the client side
  const dialog = document.getElementById(id);

  if (dialog) {
    // Click outside to close
    dialog.addEventListener("click", (event) => {
      const rect = dialog.getBoundingClientRect();
      const isInDialog =
        rect.top <= event.clientY &&
        event.clientY <= rect.top + rect.height &&
        rect.left <= event.clientX &&
        event.clientX <= rect.left + rect.width;

      if (!isInDialog) {
        dialog.close();
      }
    });
  }
</script>
